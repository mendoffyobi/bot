<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <title>監視タグを編集</title>
    <style type="text/css">
    .hide {
      display: none;
    }
    .loading {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: rgba(0,0,0,.5);
      background-image: url(./img/loading.svg);
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center 20%;
      background-size: 150px 150px;
    }
    </style>
    <script>
      var getUrlVars = function(){
        var vars = {};
        var param = location.search.substring(1).split('&');
        for(var i = 0; i < param.length; i++) {
          var keySearch = param[i].search(/=/);
          var key = '';
          if(keySearch != -1) key = param[i].slice(0, keySearch);
          var val = param[i].slice(param[i].indexOf('=', 0) + 1);
          if(key != '') vars[key] = decodeURI(val);
        }
        return vars;
      };
      var loadUrl = function(url) {
        $.ajax({
          url: url,
          type: 'GET',
          beforeSend: function(){
            $('.loading').removeClass('hide');
          }
        }).done(function(data){
          $('.loading').addClass('hide');
          $("#preview").html(data);
        }).fail(function(XMLHttpRequest, textStatus, errorThrown){
          $('.loading').addClass('hide');
          alert('URLロードに失敗しました');
          alert(textStatus);
          alert(errorThrown);
        });
      };
      var editKey = function() {
        $("#preview").html($("#edit").val());
      };
      window.onload = function (e) {
        try {
          liff.init(function (data) {
          });
          var param = getUrlVars();
          loadUrl('https://www.google.com');
        } catch(ex) {
          alert(ex);
        }
      }
    </script>
</head>
<body>
<div>
  <div>
    <div id="preview">
    </div>
  </div>
  <div>
    <textarea id="edit" rows="5" cols="60" onkeyup="editKey();"></textarea>
  </div>
</div>
</body>
</html>
